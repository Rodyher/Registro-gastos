#!/usr/bin/env python3

import datetime
from github import Github
import os

def limpiar_consola():
    os.system('cls' if os.name == 'nt' else 'clear')

# Autenticación en GitHub
# Reemplaza 'tu-token' con tu token de autenticación de GitHub
g = Github('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')

# Obtener el repositorio
repo = g.get_repo('rodyher/Registro-gastos')

def descargar_archivo():
    # Descargar el archivo
    archivo = repo.get_contents("data.txt")
    contenido = archivo.decoded_content.decode('utf-8')
    sha = archivo.sha
    print(sha)

    # Guardar el archivo localmente
    with open('data.txt', 'w') as f:
        f.write(contenido)
    return sha

def actualizar():
    # Obtener el contenido actual del archivo en GitHub
    archivo = repo.get_contents("data.txt")
    sha = archivo.sha

    # Leer el contenido actual del archivo data.txt
    with open('data.txt', 'r') as file:
        contenido = file.read()
    
    # Actualizar el archivo localmente
    with open('data.txt', 'w') as file:
        file.write(contenido)

    # Subir el archivo actualizado al repositorio
    with open('data.txt', 'r') as file:
        contenido = file.read()
        repo.update_file('data.txt', 'Funcionando', contenido, sha, branch='main')

    # Mostrar
    print()
    print("------------------------------------------------------")
    print()
    print(f"Dato agregado correctamente.")
    print()
    print("------------------------------------------------------")
    print()
    input("Presione Enter para continuar...")
    main()




def escribir():
    with open('data.txt', "a") as archivo:
            archivo.write(f"(00/00/00), ADD, 100\n")


def main():
    while True:
        opcion = input("1-descargar 2-escribir 3-subir 4-salir")
        if opcion == "1":
            descargar_archivo()
        elif opcion == "2":
            escribir()
        elif opcion == "3":
            actualizar()
        elif opcion == "4":
            print("Saliendo del programa...")
            break
        else:
            limpiar_consola()
            print()
            print()
            print("Opción no válida. Por favor, ingrese una opción válida.")
            print()
            print()
            print()
            print()
            print()
            print()
            input("Presione Enter para continuar...")
            exit()
            limpiar_consola()

if __name__ == "__main__":
    limpiar_consola()
    main()
